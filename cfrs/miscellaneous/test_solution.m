clc;
% Test for the subroutine Solve_LS_Householder  

% Matrix with weights
% This test failed -- there is a bug in HT12_row

% AW=[ -2.093656e-01 2.114593e-01 -1.512815e-01
%  -9.900990e-01 5.000000e-01 -2.104167e-01
%  9.900990e-01 5.000000e-01 2.104167e-01
%  4.950495e-01 5.000000e-01 3.577083e-01]
% 
% BW=[ 4.364948e-01
%  4.353389e-16
%  0.000000e+00
%  0.000000e+00]


% 
% AW=[ 1.000000e-02 1.000000e-01 1.000000e+00 1.000000e+01 1.000000e+02
%  2.500000e-02 2.500000e-01 2.500000e+00 2.500000e+01 2.500000e+02
%  3.500000e+01 3.500000e+00 3.500000e-01 3.500000e-02 3.500000e-03
%  4.350000e+02 4.350000e-01 4.350000e-02 4.350000e-03 4.350000e-06]
% 
% BW=(1/3)*[ 0.000000e+00
%  2.400000e+01
%  3.200000e+01
%  -4.300000e-16]

% Above test introduced 
% 
% AW=[ -3.300330e-01 5.000000e-01 -5.190278e-01 4.037896e-01 -2.534612e-01
%  -4.950495e-01 5.000000e-01 -3.577083e-01 1.912687e-01 -8.326478e-02
%  -9.900990e-01 5.000000e-01 -2.104167e-01 6.375625e-02 -1.627732e-02
%  9.900990e-01 5.000000e-01 2.104167e-01 6.375625e-02 1.627732e-02
%  4.950495e-01 5.000000e-01 3.577083e-01 1.912687e-01 8.326478e-02
%  2.501813e-01 3.790247e-01 3.934487e-01 3.060924e-01 1.921361e-01]
% 
% BW=[ 1.934840e-16
%  4.353389e-16
%  0.000000e+00
%  1.741356e-15
%  4.353389e-16
%  -3.995151e-01]

% Above test introduced 

% AW= [9.480438e-02 9.575242e-02 6.850288e-02
%     -0.000000e+00 0.000000e+00 -0.000000e+00
%  0.000000e+00 0.000000e+00 0.000000e+00
%   -0.000000e+00 0.000000e+00 -0.000000e+00]
% 
% BW=[5.121065e-02 
%  -0.000000e+00
%  0.000000e+00
%  0.000000e+00]
% 
% Above test introduced 

% AW=[ -4.942834e-01 4.992262e-01 -3.571548e-01
%  -9.900990e-01 5.000000e-01 -2.104167e-01
%  9.900990e-01 5.000000e-01 2.104167e-01
%  4.950495e-01 5.000000e-01 3.577083e-01]
% 
% BW=[-2.669979e-01
%  -7.080900e-03
%  -2.464985e-04
%  -6.289122e-05]
% Above test introduced 

% AW=[ -0.000000e+00 0.000000e+00 -0.000000e+00 0.000000e+00
%  -0.000000e+00 0.000000e+00 -0.000000e+00 0.000000e+00
%  -0.000000e+00 0.000000e+00 -0.000000e+00 0.000000e+00
%  0.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00
%  0.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00
%  4.212746e-02 6.382311e-02 6.625193e-02 5.154221e-02]
% 
% BW=[ 0.000000e+00
%  0.000000e+00
%  -0.000000e+00
%  0.000000e+00
%  0.000000e+00
%  1.516721e-02]
% Above test introduced 

% Non-smooth functions
% AW=[ -3.000000e+00
%  3.000000e+00]
% 
% BW=[ 0.000000e+00
%  -4.285714e-01]

% Above test introduced 
% 
% AW=[ -3.000000e+00
%  3.000000e+00]
% 
% BW=[ 0.000000e+00
%  -4.714286e+00]
% 
% Above test introduced 
% 
% AW=[-3.000000e+00
%  3.000000e+00]
% 
% BW=[ 0.000000e+00
%  -8.914286e+00]
% 
% AW=[-1.500000e+00 5.000000e-01
%  -3.000000e+00 5.000000e-01
%  3.000000e+00 5.000000e-01
%  1.500000e+00 5.000000e-01]
% 
% BW=[ 0.000000e+00
%  0.000000e+00
%  -8.914286e+00
%  -2.228571e+00]
% 
% AW=[ -1.500000e+00 5.000000e-01
%  -3.000000e+00 5.000000e-01
%  3.000000e+00 5.000000e-01
%  1.500000e+00 5.000000e-01]
% 
% BW=[ 7.612958e-16
%  0.000000e+00
%  0.000000e+00
%  -2.035714e+00]
% 
% AW=[-1.500000e+00 5.000000e-01
%  -3.000000e+00 5.000000e-01
%  3.000000e+00 5.000000e-01
%  1.500000e+00 5.000000e-01]
% 
% norm(AW,'fro')
% 
% BW=[ 9.516197e-16
%  0.000000e+00
%  0.000000e+00
%  -1.071429e-01]



% AW=[ -1.500000e+00 5.000000e-01
%  -3.000000e+00 5.000000e-01
%  3.000000e+00 5.000000e-01
%  1.500000e+00 5.000000e-01]
% 
% BW=[ 0.000000e+00
%  0.000000e+00
%  -4.285714e-01
%  -1.071429e-01]

% AW=[ -1.000000e-00 5.000000e-01 -1.712963e-01 4.398148e-02
%  -1.500000e+00 5.000000e-01 -1.180556e-01 2.083333e-02
%  -3.000000e+00 5.000000e-01 -6.944444e-02 6.944444e-03
%  3.000000e+00 5.000000e-01 6.944444e-02 6.944444e-03
%  1.500000e+00 5.000000e-01 1.180556e-01 2.083333e-02
%  1.000000e-00 5.000000e-01 1.712963e-01 4.398148e-02]
% 
% BW=[ 4.229421e-16
%  0.000000e+00
%  0.000000e+00
%  -4.285714e-01
%  -1.071429e-01
%  -4.761905e-02]
% Above test introduced 
% Smooth function
% AW=[ -2.500000e+00 5.000000e-01
%  -5.000000e+00 5.000000e-01
%  5.000000e+00 5.000000e-01
%  2.500000e+00 5.000000e-01]
% 
% BW=[ -3.548774e-01
%  -3.820918e+00
%  5.756713e+00
%  2.782617e+00]
%  
% AW=[-1.250000e+00 5.000000e-01 -1.354167e-01 2.750000e-02 -4.489931e-03 6.137500e-04
%  -1.666667e+00 5.000000e-01 -1.027778e-01 1.583333e-02 -1.968056e-03 2.054167e-04
%  -2.500000e+00 5.000000e-01 -7.083333e-02 7.500000e-03 -6.465278e-04 4.708333e-05
%  -5.000000e+00 5.000000e-01 -4.166667e-02 2.500000e-03 -1.263889e-04 5.416667e-06
%  5.000000e+00 5.000000e-01 4.166667e-02 2.500000e-03 1.263889e-04 5.416667e-06
%  2.500000e+00 5.000000e-01 7.083333e-02 7.500000e-03 6.465278e-04 4.708333e-05
%  1.666667e+00 5.000000e-01 1.027778e-01 1.583333e-02 1.968056e-03 2.054167e-04
%  1.250000e+00 5.000000e-01 1.354167e-01 2.750000e-02 4.489931e-03 6.137500e-04]
% 
% norm(AW,'fro')
% 
% BW=(1/16.0630)*[ 4.166255e+01
%  1.967277e+01
%  -4.440800e+00
%  -4.781350e+01
%  7.203730e+01
%  3.482060e+01
%  2.109503e+01
%  1.391725e+01]

% AW = [0.3516-0.4302*0.1593/0.4087
%     0.3384-0.6246*0.1593/0.4087]
% 
% BW = [0.6593-0.4302*0.1376/0.4087
%     0.9666-0.6246*0.1376/0.4087]

% AW=[ -2.911958e-01 9.372864e-02 -3.204096e-01 2.062637e-01 1.134784e-01
%  0.000000e+00 0.000000e+00 -5.850551e-01 -0.000000e+00 2.072070e-01
%  2.911958e-01 9.372864e-02 -3.204096e-01 -2.062637e-01 1.134784e-01
%  -6.437500e-01 2.072070e-01 0.000000e+00 -0.000000e+00 0.000000e+00
%  6.437500e-01 2.072070e-01 0.000000e+00 0.000000e+00 0.000000e+00
%  -2.911958e-01 9.372864e-02 3.204096e-01 -2.062637e-01 1.134784e-01
%  0.000000e+00 0.000000e+00 5.850551e-01 0.000000e+00 2.072070e-01
%  2.911958e-01 9.372864e-02 3.204096e-01 2.062637e-01 1.134784e-01]
% 
% BW=[ 2.181889e-02
%  3.984043e-02
%  2.181889e-02
%  0.000000e+00
%  -2.220446e-16
%  -7.982522e-04
%  -1.457577e-03
%  -7.982522e-04]
% 
%  AW=[-1.16226507551140710e+01
%      1.06140413102548088e+01]
% 
%  BW=[-3.29961094096233819e+03
%      3.59331102526692803e+03]
%  
% AW = [ -2.758547e+25 2.251875e+24 -1.953157e+23
%  -8.827352e+26 3.603001e+25 -1.838266e+24
%  3.919987e+02 1.599995e+01 8.163239e-01
%  1.224996e+01 9.999967e-01 8.673441e-02]
% 
% norm(AW,'fro')
% norm(AW,2)
% 
% BW = [ 0.000000e+00
%  0.000000e+00
%  -5.042079e+09
%  -1.575650e+08]
%  
% AW =[ -0.2759    0.0225   -0.0020
%    -8.8274    0.3603   -0.0184
%     0.0000    0.0000    0.0000
%     0.0000    0.0000    0.0000 ]
% 
% 
% BW = [   0
%          0
%    -5.0421
%    -0.1576]

% AW = [-2.137107e+01 2.829491e+00 -3.849747e-01 -9.431197e+00 1.253955e+00 -1.672944e-01 5.505868e-01 -7.409404e-02 -3.343858e-02
%  -2.660882e+01 2.352753e+00 -2.209090e-01 -1.758177e+01 1.558324e+00 -1.397689e-01 1.026412e+00 -9.165088e-02 -6.233668e-02
%  -2.555675e+01 1.138238e+00 -6.300020e-02 -3.583256e+01 1.599436e+00 -7.595790e-02 2.239813e+00 -9.968786e-02 -1.449955e-01
%  -1.242019e+06 -2.453406e+03 -5.891869e+02 -8.733471e+07 8.344558e+04 -1.382633e+04 5.976058e+06 -1.830817e+03 -4.211908e+05
%  1.200886e+03 5.097363e+01 2.738096e+00 -2.122811e+03 -9.032058e+01 -4.230395e+00 1.595229e+02 6.943145e+00 -1.228752e+01
%  1.277315e+03 1.096412e+02 1.002045e+01 -1.225060e+03 -1.052507e+02 -9.291559e+00 1.008993e+02 8.787698e+00 -8.484233e+00
%  1.097646e+03 1.416790e+02 1.880906e+01 -7.652170e+02 -9.882828e+01 -1.293222e+01 6.887879e+01 8.985118e+00 -6.309081e+00
%  -2.379282e+01 3.151843e+00 -4.290770e-01 -6.413301e+00 8.553492e-01 -1.140601e-01 2.284355e-01 -3.150407e-02 -9.017116e-03
%  -3.288552e+01 2.905953e+00 -2.727342e-01 -1.328831e+01 1.178651e+00 -1.052357e-01 4.733164e-01 -4.309201e-02 -1.868339e-02
%  -4.223948e+01 1.873919e+00 -1.035134e-01 -3.783576e+01 1.682611e+00 -7.900361e-02 1.503569e+00 -6.727653e-02 -6.501604e-02
%  -9.534325e+06 -2.197088e+04 -4.544708e+03 -6.704615e+08 4.227937e+05 -1.064315e+05 3.059298e+07 1.043283e+04 -1.490066e+06
%  1.974499e+03 8.475428e+01 4.584376e+00 -2.403810e+03 -1.033926e+02 -4.915768e+00 1.257519e+02 5.613846e+00 -6.917947e+00
%  1.653199e+03 1.428942e+02 1.314103e+01 -1.137338e+03 -9.839563e+01 -8.765897e+00 6.766375e+01 5.986079e+00 -4.186926e+00
%  1.280204e+03 1.661734e+02 2.217950e+01 -6.615726e+02 -8.592816e+01 -1.132204e+01 4.439698e+01 5.859215e+00 -3.073772e+00
%  -2.526731e+01 3.348995e+00 -4.561755e-01 -2.474778e+00 3.340983e-01 -4.437393e-02 3.153058e-02 -5.409951e-03 -7.411035e-04
%  -3.747392e+01 3.309375e+00 -3.104637e-01 -5.508947e+00 4.915162e-01 -4.308254e-02 7.018825e-02 -7.837975e-03 -1.649724e-03
%  -6.660484e+01 2.943323e+00 -1.622647e-01 -2.562952e+01 1.137622e+00 -5.165376e-02 4.340172e-01 -2.132163e-02 -1.091361e-02
%  -3.083890e+08 -8.121666e+05 -1.477724e+05 -2.168779e+10 6.626371e+06 -3.456765e+06 4.948848e+08 8.079464e+05 -1.433521e+07
%  3.321828e+03 1.441744e+02 7.852713e+00 -2.252819e+03 -9.797659e+01 -4.768516e+00 6.638351e+01 3.147739e+00 -2.274080e+00
%  2.056253e+03 1.789624e+02 1.656019e+01 -8.639593e+02 -7.527619e+01 -6.788093e+00 3.162518e+01 2.893255e+00 -1.280216e+00
%  1.447651e+03 1.889620e+02 2.535620e+01 -4.894805e+02 -6.394300e+01 -8.495609e+00 2.162504e+01 2.916938e+00 -1.025203e+00
%  -2.536051e+01 3.363181e+00 -4.583684e-01 1.864156e+00 -2.410983e-01 3.259017e-02 1.760323e-02 -3.482327e-03 4.217185e-04
%  -3.784998e+01 3.340529e+00 -3.132523e-01 4.181053e+00 -3.637514e-01 3.400679e-02 3.948171e-02 -5.336335e-03 9.458585e-04
%  -7.551065e+01 3.323801e+00 -1.828797e-01 9.879208e+00 -4.290055e-01 2.359388e-02 5.486929e-02 -6.316468e-03 1.677300e-03
%  4.694458e+03 2.059916e+02 1.129772e+01 -7.023493e+02 -3.099487e+01 -1.691006e+00 4.696148e+00 4.593982e-01 -1.304811e-01
%  2.346286e+03 2.056094e+02 1.914356e+01 -3.650904e+02 -3.206919e+01 -2.980786e+00 5.017924e+00 5.679884e-01 -1.207529e-01
%  1.563709e+03 2.052504e+02 2.768878e+01 -2.519879e+02 -3.312331e+01 -4.464605e+00 5.355989e+00 7.896025e-01 -1.497823e-01
%  -2.404403e+01 3.190336e+00 -4.350587e-01 5.886067e+00 -7.751421e-01 1.041083e-01 1.906769e-01 -2.630422e-02 6.983471e-03
%  -3.375902e+01 2.977639e+00 -2.791035e-01 1.243477e+01 -1.091727e+00 9.939803e-02 4.028199e-01 -3.734081e-02 1.475313e-02
%  -5.416774e+01 2.374964e+00 -1.304173e-01 3.527573e+01 -1.541084e+00 7.548913e-02 1.005444e+00 -4.789953e-02 3.355587e-02
%  1.122473e+08 3.695657e+05 5.442239e+04 7.894954e+09 2.725585e+06 1.273621e+06 1.803966e+08 -2.844189e+05 5.228193e+06
%  4.182065e+03 1.855053e+02 1.024481e+01 1.541744e+03 6.823066e+01 3.079838e+00 2.529054e+01 1.242984e+00 6.322711e-01
%  2.360718e+03 2.082884e+02 1.951231e+01 2.497675e+02 2.196709e+01 1.865536e+00 2.377246e+00 3.074298e-01 5.803941e-02
%  1.595246e+03 2.105535e+02 2.855508e+01 2.264427e+01 2.943728e+00 3.140079e-01 7.214216e-02 8.286997e-02 3.420412e-03
%  -2.171502e+01 2.882879e+00 -3.933554e-01 9.032360e+00 -1.193728e+00 1.602208e-01 4.983013e-01 -6.697998e-02 2.872737e-02
%  -2.754911e+01 2.428411e+00 -2.275253e-01 1.726289e+01 -1.517112e+00 1.374143e-01 9.523670e-01 -8.553372e-02 5.490455e-02
%  -3.249961e+01 1.419314e+00 -7.778719e-02 3.823525e+01 -1.664855e+00 8.020902e-02 1.961837e+00 -8.849908e-02 1.059662e-01
%  1.119268e+07 4.054235e+04 5.462092e+03 7.872606e+08 5.282601e+05 1.280174e+05 3.598522e+07 -1.026129e+04 1.755097e+06
%  2.657946e+03 1.191690e+02 6.626945e+00 2.330939e+03 1.043509e+02 4.929551e+00 9.162183e+01 4.117946e+00 3.929928e+00
%  2.093742e+03 1.859884e+02 1.752997e+01 7.624211e+02 6.765811e+01 6.032444e+00 2.470054e+01 2.253338e+00 9.083416e-01
%  1.532753e+03 2.034247e+02 2.773428e+01 2.880894e+02 3.819129e+01 5.039693e+00 7.216870e+00 1.014146e+00 2.218810e-01
%  -1.893550e+01 2.515244e+00 -3.433888e-01 1.111412e+01 -1.471461e+00 1.975052e-01 8.660370e-01 -1.156801e-01 6.900441e-02
%  -2.152376e+01 1.896116e+00 -1.775770e-01 1.905536e+01 -1.674594e+00 1.512988e-01 1.484836e+00 -1.320982e-01 1.183093e-01
%  -1.989136e+01 8.652524e-01 -4.732903e-02 3.394816e+01 -1.472205e+00 7.032884e-02 2.516060e+00 -1.114164e-01 1.911835e-01
%  1.846223e+06 7.296998e+03 9.072114e+02 1.298548e+08 1.294843e+05 2.131160e+04 8.906544e+06 3.237905e+03 6.290564e+05
%  1.609220e+03 7.291833e+01 4.083060e+00 2.213753e+03 1.001496e+02 4.819025e+00 1.378322e+02 6.208661e+00 8.893594e+00
%  1.702394e+03 1.522468e+02 1.443725e+01 1.054651e+03 9.424929e+01 8.516755e+00 5.844794e+01 5.252548e+00 3.388660e+00
%  1.397063e+03 1.864382e+02 2.555245e+01 5.032016e+02 6.710911e+01 8.967820e+00 2.421372e+01 3.269797e+00 1.236936e+00 ]
% 
% NormAW = norm(AW,'fro')
% ConditionNb = cond(AW)
% 
% BW = [-1.240429e+06
%  -2.312426e+06
%  -4.404192e+06
%  -2.689717e+11
%  7.728784e+07
%  4.069807e+07
%  2.326248e+07
%  -1.380316e+06
%  -2.860002e+06
%  -7.311016e+06
%  -2.058460e+12
%  1.257319e+08
%  5.231732e+07
%  2.698109e+07
%  -1.465137e+06
%  -3.261450e+06
%  -1.157905e+07
%  -6.637948e+13
%  2.093101e+08
%  6.463368e+07
%  3.034179e+07
%  -1.469819e+06
%  -3.296610e+06
%  -1.318537e+07
%  2.927304e+08
%  7.325583e+07
%  3.259425e+07
%  -1.392836e+06
%  -2.942474e+06
%  -9.500616e+06
%  3.108162e+13
%  2.580988e+08
%  7.321516e+07
%  3.306973e+07
%  -1.257301e+06
%  -2.402989e+06
%  -5.725666e+06
%  2.317820e+12
%  1.623663e+08
%  6.450476e+07
%  3.160114e+07
%  -1.095828e+06
%  -1.878816e+06
%  -3.520137e+06
%  3.611994e+11
%  9.731058e+07
%  5.210215e+07
%  2.864729e+07 ]


% Rec order 1
% AW = [ -2.422615e+01 -1.085078e+01
%  -1.177314e+04 -6.024202e+05
%  7.955278e+02 -4.673630e+02
%  -2.918911e+01 1.373703e+00
%  1.049985e+03 -6.873907e+01
%  -2.270094e+01 1.242770e+01
%  8.501056e+03 3.188155e+05
%  8.697785e+02 3.772571e+02 ]
% 
% NormAW = norm(AW,'fro')
% ConditionNb = cond(AW)
% 
% BW = [ -4.625171e+06
%  -2.243558e+09
%  2.589305e+07
%  -5.604175e+06
%  3.368948e+07
%  -4.391189e+06
%  1.649115e+09
%  2.737079e+07 ]

format long

% AW = [ -8.333333e-03 2.777778e-04 -9.837963e-06
%  -1.666667e-02 2.777778e-04 -5.787037e-06
%  1.203731e-09 2.006218e-11 4.179621e-13
%  9.023437e-09 3.007812e-10 1.065267e-11 ]
% 
% NormAW = norm(AW,'fro')
% ConditionNb = cond(AW)
% 
% BW = [ 0.000000e+00
%  0.000000e+00
%  -7.511280e-06
%  -2.815312e-05 ]


%%%%%%%%%%%%%%%%%%%%   Test 1D with 4 neighbours in stencil %%%%%%%%%%%%%%%%%%%%%%%%%%

% AW = [ -8.333333e-03 2.777778e-04 -9.837963e-06
%  -1.666667e-02 2.777778e-04 -5.787037e-06
%  1.666667e-02 2.777778e-04 5.787037e-06
%  8.333333e-03 2.777778e-04 9.837963e-06]
% 
% BW = [ 0.000000e+00
%  0.000000e+00
%  -1.040000e+02
%  -26]
% 
% Weights = [ 1
%             1
%             7.22238e-08
%             1.08281e-06 ]
%         
% 
% for m=1:4
%    AW(m,:) = Weights(m)*AW(m,:);
%    BW(m) = Weights(m)*BW(m);
% end
% 
% NormAW = norm(AW,'fro')
% ConditionNb = cond(AW)

%%%%%%%%%%%%%%%%%%%%   Test 1D with 4 neighbours in stencil and dropping one order %%%%%%%%%%%%%%%%%%%%%%%%%%

% AW = [ -8.333333e-03 2.777778e-04 0.0
%        -1.666667e-02 2.777778e-04 0.0
%         1.666667e-02 2.777778e-04 0.0
%         8.333333e-03 2.777778e-04 0.0]
% 
% BW = [ 0.000000e+00
%  0.000000e+00
%  -1.040000e+02
%  -26]
% 
% Weights = [ 1
%             1
%             7.22238e-08
%             1.08281e-06 ]
%         
% 
% for m=1:4
%    AW(m,:) = Weights(m)*AW(m,:);
%    BW(m) = Weights(m)*BW(m);
% end
% 
% NormAW = norm(AW,'fro')
% ConditionNb = cond(AW)


%%%%%%%%%%%%%%%%%%%%   Test 1D with 6 neighbours in stencil %%%%%%%%%%%%%%%%%%%%%%%%%%

% AW = [ -5.555556e-03 2.777778e-04 -1.427469e-05
%  -8.333333e-03 2.777778e-04 -9.837963e-06
%  -1.666667e-02 2.777778e-04 -5.787037e-06
%  1.203731e-09 2.006218e-11 4.179621e-13
%  9.023437e-09 3.007812e-10 1.065267e-11
%  2.856606e-08 1.428303e-09 7.339890e-11]
% 
% NormAW = norm(AW,'fro')
% ConditionNb = cond(AW)
% 
% % Conclusions: The condition number is much smaller.
% 
% BW = [ -1.531614e-13
%  -3.446132e-13
%  -1.378453e-12
%  -7.511280e-06
%  -2.815312e-05
%  -5.941740e-05]
% 

% AW = [ -6.858711e-05 3.429355e-06 -1.762308e-07
%  -5.208333e-04 1.736111e-05 -6.148727e-07
%  -1.666667e-02 2.777778e-04 -5.787037e-06
%  1.203731e-09 2.006218e-11 4.179621e-13
%  5.639648e-10 1.879883e-11 6.657918e-13
%  3.526674e-10 1.763337e-11 9.061593e-13]
% 
% BW =  -1.890882e-15
%  -2.153833e-14
%  -1.378453e-12
%  -7.511281e-06
%  -1.759570e-06
%  -7.335482e-07


%%%%%%%%%%%%%%%%%%%%   Test 2D for 3rd Order reconstruction with 24 neighbours in stencil %%%%%%%%%%%%%%%%%%%%%%%%%%

AW = [ -1.880071e-07 2.032509e-08 -2.334639e-09 -1.512231e-07 1.634844e-08 -1.804220e-09 1.314983e-08 -1.451221e-09 -1.214930e-09
 -2.584236e-06 1.396884e-07 -9.438408e-09 -4.157250e-06 2.247162e-07 -1.315906e-08 3.615000e-07 -1.994763e-08 -3.339945e-08
 0.000000e+00 0.000000e+00 0.000000e+00 -2.173913e-02 0.000000e+00 -5.293190e-06 1.890359e-03 0.000000e+00 -1.746527e-04
 9.747102e-03 5.268704e-04 3.559935e-05 -1.568012e-02 -8.475741e-04 -4.963272e-05 1.363489e-03 7.523756e-05 -1.259745e-04
 1.061693e-02 1.147776e-03 1.318392e-04 -8.539704e-03 -9.232113e-04 -1.018859e-04 7.425830e-04 8.195173e-05 -6.860821e-05
 -1.382729e-07 1.494842e-08 -1.717049e-09 -5.560976e-08 6.011866e-09 -6.634717e-10 2.417816e-09 -2.831676e-10 -1.314030e-10
 -1.403380e-06 7.585836e-08 -5.125565e-09 -1.128805e-06 6.101651e-08 -3.573039e-09 4.907849e-08 -2.873966e-09 -2.667309e-09
 0.000000e+00 0.000000e+00 0.000000e+00 -4.347826e-02 0.000000e+00 -1.058638e-05 1.890359e-03 0.000000e+00 -1.027369e-04
 2.123386e-02 1.147776e-03 7.755244e-05 -1.707941e-02 -9.232113e-04 -5.406192e-05 7.425830e-04 4.348459e-05 -4.035777e-05
 1.505136e-02 1.627174e-03 1.869051e-04 -6.053263e-03 -6.544069e-04 -7.222058e-05 2.631854e-04 3.082351e-05 -1.430355e-05
 -1.209338e-07 1.307392e-08 -1.501734e-09 0.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00 -1.905069e-11 0.000000e+00
 -9.234623e-07 4.991688e-08 -3.372762e-09 0.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00 -1.454730e-10 0.000000e+00
 3.497164e-02 1.890359e-03 1.277270e-04 0.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00 5.509081e-06 0.000000e+00
 1.748582e-02 1.890359e-03 2.171359e-04 0.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00 2.754540e-06 0.000000e+00
 -1.382729e-07 1.494842e-08 -1.717049e-09 5.560976e-08 -6.011866e-09 6.634717e-10 2.417816e-09 -2.831676e-10 1.314030e-10
 -1.403380e-06 7.585836e-08 -5.125565e-09 1.128805e-06 -6.101651e-08 3.573039e-09 4.907849e-08 -2.873966e-09 2.667309e-09
 0.000000e+00 -8.131516e-20 3.519654e-22 4.347826e-02 0.000000e+00 1.058638e-05 1.890359e-03 0.000000e+00 1.027369e-04
 2.123386e-02 1.147776e-03 7.755244e-05 1.707941e-02 9.232113e-04 5.406192e-05 7.425830e-04 4.348459e-05 4.035777e-05
 1.505136e-02 1.627174e-03 1.869051e-04 6.053263e-03 6.544069e-04 7.222058e-05 2.631854e-04 3.082351e-05 1.430355e-05
 -1.880071e-07 2.032509e-08 -2.334639e-09 1.512231e-07 -1.634844e-08 1.804220e-09 1.314983e-08 -1.451221e-09 1.214930e-09
 -2.584236e-06 1.396884e-07 -9.438408e-09 4.157250e-06 -2.247162e-07 1.315906e-08 3.615000e-07 -1.994763e-08 3.339945e-08
 0.000000e+00 0.000000e+00 0.000000e+00 2.173913e-02 0.000000e+00 5.293190e-06 1.890359e-03 0.000000e+00 1.746527e-04
 9.747102e-03 5.268704e-04 3.559935e-05 1.568012e-02 8.475741e-04 4.963272e-05 1.363489e-03 7.523756e-05 1.259745e-04
 1.061693e-02 1.147776e-03 1.318392e-04 8.539704e-03 9.232113e-04 1.018859e-04 7.425830e-04 8.195173e-05 6.860821e-05 ]
% 
% NormAW = norm(AW,'fro')
% ConditionNb = cond(AW)
% 
BW = [ -1.812450e-02
 -1.743902e-01
 0.000000e+00
 0.000000e+00
 0.000000e+00
 -1.332996e-02
 -9.470329e-02
 0.000000e+00
 0.000000e+00
 0.000000e+00
 -1.165841e-02
 -6.231736e-02
 0.000000e+00
 0.000000e+00
 -1.332996e-02
 -9.470329e-02
 0.000000e+00
 7.145471e-13
 0.000000e+00
 -1.812450e-02
 -1.743902e-01
 0.000000e+00
 0.000000e+00
 0.000000e+00 ]

% AW = [ -2.670686e-05 2.025494e-06 -1.327620e-05 1.006770e-06 4.978543e-07
%  -1.380027e-05 6.126626e-07 -1.744310e-05 7.751888e-07 9.785559e-07
%  -4.350365e-06 5.690274e-08 -2.450389e-05 3.265808e-07 1.841722e-06
%  6.743105e-06 1.165101e-07 -3.654598e-05 -6.395953e-07 3.461082e-06
%  2.195000e-05 1.052709e-06 -5.244231e-05 -2.519554e-06 6.017075e-06
%  -1.945062e-02 1.357220e-03 -1.296822e-04 8.709350e-06 -1.604825e-06
%  -9.576239e-06 3.645169e-07 -4.738355e-06 1.803186e-07 8.828135e-08
%  -1.240919e-06 7.982925e-09 -6.985240e-06 4.666245e-08 2.632864e-07
%  6.772462e-06 1.649062e-07 -1.585427e-05 -3.873759e-07 9.060109e-07
%  2.108065e-05 1.164386e-06 -2.939424e-05 -1.624625e-06 2.265301e-06
%  -9.590235e-06 6.104654e-07 5.589495e-06 -3.558555e-07 2.069022e-07
%  -4.630354e-06 1.467174e-07 2.747093e-06 -8.707645e-08 5.141220e-08
%  7.007500e-06 2.201792e-07 -4.304418e-06 -1.351836e-07 8.343281e-08
%  1.983383e-05 1.240745e-06 -1.239170e-05 -7.749855e-07 4.853379e-07
%  -1.054171e-05 6.058859e-07 1.376109e-05 -7.904089e-07 1.031952e-06
%  -3.295192e-06 8.326957e-08 7.423421e-06 -1.869801e-07 4.216720e-07
%  5.845595e-07 4.116832e-09 3.288033e-06 2.234774e-08 1.254215e-07
%  6.592469e-06 2.539612e-07 3.234150e-06 1.246239e-07 6.178888e-08
%  1.305668e-02 9.130373e-04 -1.512490e-04 -1.030458e-05 1.251218e-06
%  -1.149351e-05 5.889217e-07 2.542957e-05 -1.300933e-06 2.879945e-06
%  -3.490596e-06 6.576957e-08 1.779345e-05 -3.315561e-07 1.692874e-06
%  2.138127e-06 2.966010e-08 1.202388e-05 1.638445e-07 9.203825e-07
%  6.835282e-06 3.121693e-07 8.601378e-06 3.924243e-07 4.944763e-07
%  1.318737e-05 1.020086e-06 6.444188e-06 4.985533e-07 2.449291e-07 ]

ConditionNb_AW = cond(AW)

[Q,R] = qr(AW);

ConditionNb_R = cond(R)

for i=1:9
   R_p(i,:) = R(i,:);
end

R_p

ConditionNb_Estimation_R = condest(R_p)
 
S_AW = svd(AW)

% 
% BW = [ -1.591006e+00
%  -1.402714e+00
%  -1.472672e+00
%  -1.744054e+00
%  -2.066251e+00
%  -3.875340e+01
%  -1.052882e+00
%  -8.363447e-01
%  -1.253989e+00
%  -1.724713e+00
%  8.889304e-01
%  7.082716e-01
%  -9.336077e-01
%  -1.433614e+00
%  1.082753e+00
%  7.714454e-01
%  5.096168e-01
%  8.229079e-01
%  -3.933199e+01
%  1.325243e+00
%  1.104099e+00
%  9.278045e-01
%  8.848331e-01
%  1.006693e+00 ]
 
 
 XW = pinv(AW)*BW
%   
Rez = norm(AW*XW-BW)
 
%  AW = [ -1.379277e-03 2.935969e-05 -6.580846e-07 -1.366184e-03 2.908261e-05 -6.269783e-07 2.879749e-05 -6.305484e-07 -6.678154e-07
%  -6.408664e-04 7.393702e-06 -1.006735e-07 -1.310558e-03 1.512504e-05 -1.835750e-07 3.092437e-05 -3.635257e-07 -7.880665e-07
%  -1.004673e-04 1.784056e-07 -2.723383e-09 -1.450970e-03 2.628797e-06 -1.606092e-08 3.797151e-05 -6.703740e-08 -1.058369e-06
%  3.654936e-07 2.883158e-09 3.148720e-11 -1.332782e-06 -1.052819e-08 -9.454230e-11 3.838359e-08 3.116700e-10 -1.164874e-09
%  8.025738e-07 1.411384e-08 2.673758e-10 -1.436639e-06 -2.527331e-08 -4.577701e-10 4.523477e-08 8.110127e-10 -1.488409e-09
%  -9.014358e-04 1.840862e-05 -3.976081e-07 -3.532491e-04 7.213754e-06 -1.481615e-07 2.822930e-06 -7.026284e-08 -3.827253e-08
%  -2.732390e-04 2.911063e-06 -3.757679e-08 -2.697036e-04 2.873714e-06 -3.216964e-08 2.834739e-06 -3.366591e-08 -4.180030e-08
%  -3.454057e-05 3.006031e-08 -8.546322e-10 -4.984986e-04 4.517994e-07 -4.306991e-09 6.522450e-06 -5.306430e-09 -1.075472e-07
%  1.101410e-07 9.712691e-10 1.120346e-11 -1.961697e-07 -1.731112e-09 -1.708465e-11 3.082504e-09 2.928415e-11 -5.718197e-11
%  4.629614e-07 8.579979e-09 1.700862e-10 -4.595697e-07 -8.519032e-09 -1.626140e-10 8.455739e-09 1.646823e-10 -1.760827e-10
%  -7.727388e-04 1.511117e-05 -3.141112e-07 2.008957e-04 -3.928155e-06 8.013061e-08 1.020017e-06 -3.184825e-08 1.411128e-08
%  -1.340362e-04 1.309514e-06 -1.601724e-08 3.525955e-05 -3.444035e-07 3.945482e-09 9.038107e-08 -2.949886e-09 1.800485e-09
%  3.905732e-08 3.807708e-10 4.649002e-12 -1.051854e-08 -1.025695e-10 -1.172597e-12 2.769019e-11 8.737339e-13 -5.415868e-13
%  2.984921e-07 5.815003e-09 1.204338e-10 -8.133298e-08 -1.584659e-09 -3.220375e-11 4.323150e-10 1.304234e-11 -5.924824e-12
%  -1.027508e-03 1.920227e-05 -3.836301e-07 9.993339e-04 -1.867188e-05 3.592221e-07 1.816195e-05 -3.567604e-07 3.744871e-07
%  -2.986184e-04 2.653290e-06 -3.076608e-08 5.266202e-04 -4.675996e-06 4.643098e-08 8.248185e-06 -7.883282e-08 1.526066e-07
%  3.110185e-05 2.938665e-08 7.757324e-10 4.483349e-04 4.074246e-07 3.904277e-09 5.871361e-06 4.788994e-09 9.684333e-08
%  9.180015e-08 9.804505e-10 1.267640e-11 8.998141e-08 9.609235e-10 1.077467e-11 9.424884e-10 1.122146e-11 1.387933e-11
%  3.642825e-07 7.442614e-09 1.607970e-10 1.388243e-07 2.836361e-09 5.822601e-11 1.082555e-09 2.720125e-11 1.462934e-11
%  -1.402977e-03 2.500135e-05 -4.794009e-07 2.462126e-03 -4.386115e-05 8.044499e-07 7.698236e-05 -1.397560e-06 2.516341e-06
%  -5.153267e-04 4.122820e-06 -4.541007e-08 1.854361e-03 -1.481578e-05 1.345351e-07 5.332360e-05 -4.377899e-07 1.615786e-06
%  1.578847e-05 2.927424e-08 4.344782e-10 2.274756e-04 4.135543e-07 2.552260e-09 5.957529e-06 1.055283e-08 1.661445e-07
%  2.930164e-07 3.402544e-09 4.655802e-11 5.947934e-07 6.904503e-09 8.426931e-11 1.401813e-08 1.657110e-10 3.568570e-10
%  6.878022e-07 1.470625e-08 3.309621e-10 6.718203e-07 1.436379e-08 3.109159e-10 1.403454e-08 3.087051e-10 3.231148e-10]


 
% AW = [ -2.670686e-05 0.000000e+00 -1.327620e-05 1.006770e-06 0.000000e+00
%  -1.380027e-05 0.000000e+00 -1.744310e-05 7.751888e-07 0.000000e+00
%  -4.350365e-06 0.000000e+00 -2.450389e-05 3.265808e-07 0.000000e+00
%  6.743105e-06 0.000000e+00 -3.654598e-05 -6.395953e-07 0.000000e+00
%  2.195000e-05 0.000000e+00 -5.244231e-05 -2.519554e-06 0.000000e+00
%  -1.945062e-02 0.000000e+00 -1.296822e-04 8.709350e-06 0.000000e+00
%  -9.576239e-06 0.000000e+00 -4.738355e-06 1.803186e-07 0.000000e+00
%  -1.240919e-06 0.000000e+00 -6.985240e-06 4.666245e-08 0.000000e+00
%  6.772462e-06 0.000000e+00 -1.585427e-05 -3.873759e-07 0.000000e+00
%  2.108065e-05 0.000000e+00 -2.939424e-05 -1.624625e-06 0.000000e+00
%  -9.590235e-06 0.000000e+00 5.589495e-06 -3.558555e-07 0.000000e+00
%  -4.630354e-06 0.000000e+00 2.747093e-06 -8.707645e-08 0.000000e+00
%  7.007500e-06 0.000000e+00 -4.304418e-06 -1.351836e-07 0.000000e+00
%  1.983383e-05 0.000000e+00 -1.239170e-05 -7.749855e-07 0.000000e+00
%  -1.054171e-05 0.000000e+00 1.376109e-05 -7.904089e-07 0.000000e+00
%  -3.295192e-06 0.000000e+00 7.423421e-06 -1.869801e-07 0.000000e+00
%  5.845595e-07 0.000000e+00 3.288033e-06 2.234774e-08 0.000000e+00
%  6.592469e-06 0.000000e+00 3.234150e-06 1.246239e-07 0.000000e+00
%  1.305668e-02 0.000000e+00 -1.512490e-04 -1.030458e-05 0.000000e+00
%  -1.149351e-05 0.000000e+00 2.542957e-05 -1.300933e-06 0.000000e+00
%  -3.490596e-06 0.000000e+00 1.779345e-05 -3.315561e-07 0.000000e+00
%  2.138127e-06 0.000000e+00 1.202388e-05 1.638445e-07 0.000000e+00
%  6.835282e-06 0.000000e+00 8.601378e-06 3.924243e-07 0.000000e+00
%  1.318737e-05 0.000000e+00 6.444188e-06 4.985533e-07 0.000000e+00 ]

% NormAW = norm(AW,'fro')
% ConditionNb = cond(AW)

% BW = [ -1.591006e+00
%  -1.402714e+00
%  -1.472672e+00
%  -1.744054e+00
%  -2.066251e+00
%  -3.875340e+01
%  -1.052882e+00
%  -8.363447e-01
%  -1.253989e+00
%  -1.724713e+00
%  8.889304e-01
%  7.082716e-01
%  -9.336077e-01
%  -1.433614e+00
%  1.082753e+00
%  7.714454e-01
%  5.096168e-01
%  8.229079e-01
%  -3.933199e+01
%  1.325243e+00
%  1.104099e+00
%  9.278045e-01
%  8.848331e-01
%  1.006693e+00 ]
% 

% AW = [ -2.105206e-01 4.439475e-02 -9.690806e-03 1.208034e-01 -2.559492e-02 5.539536e-03 1.421464e-02 -3.317332e-03 2.070223e-03
%  -1.705105e-01 2.919128e-02 -5.263735e-03 1.842816e-02 -3.345535e-03 6.474001e-04 6.351119e-06 -2.170946e-04 5.426915e-05
%  -1.320565e-01 1.760048e-02 -2.552251e-03 -8.433237e-02 1.089107e-02 -1.440617e-03 6.824334e-03 -1.003823e-03 -8.274126e-04
%  -9.587086e-02 9.417104e-03 -1.076537e-03 -1.880797e-01 1.775403e-02 -1.794965e-03 3.514511e-02 -3.357986e-03 -7.181573e-03
%  -6.130150e-02 4.091128e-03 -3.723445e-04 -2.925324e-01 1.761016e-02 -1.284271e-03 8.540641e-02 -5.100978e-03 -2.588986e-02
%  -1.420748e-01 2.010539e-02 -3.034917e-03 1.485310e-01 -2.106457e-02 3.077526e-03 2.189688e-02 -3.307972e-03 3.752525e-03
%  -1.002638e-01 1.000907e-02 -1.132399e-03 4.568102e-02 -4.561751e-03 4.926274e-04 1.972428e-03 -3.255748e-04 2.452942e-04
%  -5.997512e-02 3.590352e-03 -2.943636e-04 -5.745510e-02 3.444277e-03 -2.231788e-04 3.239125e-03 -2.575210e-04 -3.850730e-04
%  -2.015461e-02 4.611849e-04 -3.728295e-05 -1.606177e-01 3.220404e-03 -1.402801e-04 2.579059e-02 -5.234894e-04 -4.705182e-03
%  1.955655e-02 5.150068e-04 3.986377e-05 -2.631593e-01 -5.166284e-03 -2.463202e-04 6.931981e-02 1.400990e-03 -1.918674e-02
%  -8.803906e-02 7.642144e-03 -7.733357e-04 2.060512e-01 -1.811244e-02 1.683673e-03 4.239407e-02 -3.878444e-03 9.478543e-03
%  -4.324870e-02 1.810320e-03 -1.298780e-04 1.030184e-01 -4.437478e-03 2.381917e-04 1.058532e-02 -5.264431e-04 1.462985e-03
%  4.412229e-02 2.050047e-03 1.537099e-04 -1.023857e-01 -4.558878e-03 -2.597526e-04 1.048900e-02 5.333957e-04 -1.438173e-03
%  8.930827e-02 8.182109e-03 8.727002e-04 -2.041252e-01 -1.829373e-02 -1.766495e-03 4.169560e-02 3.864563e-03 -9.234312e-03
%  -4.154715e-02 1.645129e-03 -1.160989e-04 2.722063e-01 -1.131476e-02 5.774878e-04 7.407135e-02 -3.200102e-03 2.117610e-02
%  7.451169e-03 2.687002e-05 9.120502e-06 1.683494e-01 1.240930e-03 7.349194e-05 2.835514e-02 1.819555e-04 5.402868e-03
%  5.517672e-02 3.085605e-03 2.415321e-04 6.419233e-02 3.508103e-03 2.115924e-04 4.164132e-03 2.824060e-04 5.072461e-04
%  1.051217e-01 1.122458e-02 1.338526e-03 -4.009328e-02 -4.314636e-03 -4.982282e-04 1.667311e-03 3.129502e-04 -2.147105e-04
%  1.572408e-01 2.501227e-02 4.197190e-03 -1.444458e-01 -2.283928e-02 -3.715904e-03 2.093152e-02 3.521208e-03 -3.551039e-03
%  8.472897e-04 -3.400360e-05 9.289521e-07 3.418366e-01 2.472605e-04 1.323922e-04 1.168358e-01 -1.907603e-05 4.123147e-02
%  5.446522e-02 2.986814e-03 2.307478e-04 2.371490e-01 1.286403e-02 7.865062e-04 5.627010e-02 3.056654e-03 1.424863e-02
%  1.071704e-01 1.158337e-02 1.386151e-03 1.316687e-01 1.403256e-02 1.540913e-03 1.740780e-02 1.954302e-03 2.796685e-03
%  1.633951e-01 2.695684e-02 4.668706e-03 2.492448e-02 3.901149e-03 6.051146e-04 7.391993e-04 3.062324e-04 1.153669e-04
%  2.228804e-01 5.005109e-02 1.155363e-02 -8.273313e-02 -1.863718e-02 -4.273540e-03 6.970651e-03 1.856307e-03 -8.913905e-04 ]
%  
%   NormAW = norm(AW,'fro')
% ConditionNb = cond(AW)
% 
% BW = [ 8.418184e-01
%  -2.155848e-01
%  -5.836890e-01
%  3.409335e-01
%  1.126614e+00
%  2.891992e-01
%  -6.125509e-01
%  -2.436299e-01
%  9.178649e-01
%  9.795266e-01
%  1.818923e-02
%  -6.658237e-01
%  1.078387e+00
%  7.600898e-01
%  -1.271559e-01
%  -6.555239e-01
%  1.851542e-01
%  1.149022e+00
%  4.935562e-01
%  -2.268430e-01
%  -6.257912e-01
%  3.385581e-01
%  1.162271e+00
%  2.292192e-01]
% 
% 
% 
% XW = pinv(AW)*BW
% %   
% Rez = norm(AW*XW-BW)


%&&&&&&&&&&&&&& Test for the condition number &&&&&&&&&&&&&&&&&&&&&&&&&&&
A = [0.4087  0.1593 0.6593
    0.3515  0.9665  0.6245
    0.6590  0.9343  0.9039]

ConditionNb = cond(A)
ConditionNb = cond(A,'fro')

[U,S,V] = svd(A)

S = svd(A)


% 
% Rez2 = norm(AW*XW-BW)
% 
% Rez_max = max(abs(Rez))
% 
% Rez = Rez/Rez_max

%norma = norm(Rez)